<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Catch My Love</title>
    <style>
        :root {
            --rose-pink: #ff4d6d;
            --soft-pink: #fff0f3;
            --deep-red: #c9184a;
            --parchment: #fdf5e6;
        }

        body {
            margin: 0;
            padding: 0;
            height: 100vh;
            background: radial-gradient(circle, #fff0f3 0%, #ffccd5 100%);
            font-family: 'Arial Rounded MT Bold', 'Helvetica', sans-serif;
            overflow: hidden;
            touch-action: manipulation;
        }

        /* --- Game Elements --- */
        #game-container { width: 100%; height: 100%; display: flex; flex-direction: column; align-items: center; }
        #basket { position: absolute; top: 20px; font-size: 60px; width: 80px; text-align: center; z-index: 10; }
        #ui-layer { position: absolute; top: 130px; text-align: center; z-index: 5; width: 100%; }
        #score-board { font-size: 28px; color: var(--deep-red); margin: 0; }
        .flower-projectile { position: absolute; bottom: -50px; font-size: 35px; z-index: 2; }

        /* --- Valentine Screen --- */
        #valentine-screen { display: none; flex-direction: column; align-items: center; height: 100vh; padding-top: 40px; box-sizing: border-box; }
        .flower-container { position: relative; width: 150px; height: 160px; margin-bottom: 10px; }
        .petal { position: absolute; width: 55px; height: 85px; background: linear-gradient(to top, var(--deep-red), var(--rose-pink)); border-radius: 50% 50% 50% 50% / 80% 80% 20% 20%; left: 48px; transform-origin: bottom center; opacity: 0; box-shadow: inset 0 0 10px rgba(0,0,0,0.1); }
        .stem { position: absolute; width: 6px; height: 80px; background: #2d6a4f; left: 72px; top: 80px; border-radius: 5px; opacity: 0; }
        .bloom-anim { animation: bloomIn 1.5s ease-out forwards; }
        .stem-anim { animation: fadeIn 1s ease-out 0.5s forwards; }

        @keyframes bloomIn { 0% { transform: scale(0) rotate(0deg); opacity: 0; } 100% { opacity: 0.9; } }
        @keyframes fadeIn { to { opacity: 1; } }

        h1 { color: var(--deep-red); margin: 15px; text-align: center; font-size: 1.5rem; line-height: 1.3; }
        #hint-text { color: var(--deep-red); font-weight: bold; height: 20px; margin-bottom: 10px; opacity: 0; transition: opacity 0.3s; }

        .btn-group { display: flex; flex-direction: column; gap: 10px; align-items: center; width: 100%; position: relative; }
        .row { display: flex; gap: 20px; justify-content: center; width: 100%; }
        button { padding: 15px 30px; font-size: 1rem; border: none; border-radius: 50px; font-weight: bold; cursor: pointer; transition: 0.3s; }
        #yesBtn { background: var(--rose-pink); color: white; z-index: 10; }
        #noBtn { background: #adb5bd; color: white; position: absolute; z-index: 100; transition: left 0.2s ease, top 0.2s ease; }
        
        .secondary-btn { display: none; width: 220px; margin-top: 10px; }
        #readLetterBtn { background: #8b4513; color: white; }
        #planDateBtn { background: #2d6a4f; color: white; }

        /* --- Modals --- */
        .modal {
            display: none; position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%);
            width: 85%; max-width: 400px; background: var(--parchment); padding: 25px;
            border-radius: 15px; box-shadow: 0 10px 30px rgba(0,0,0,0.3); z-index: 1001;
            text-align: center; border: 2px solid #d2b48c; max-height: 85vh; overflow-y: auto;
        }
        
        /* --- Form Styles --- */
        .form-group { text-align: left; margin-bottom: 15px; }
        label { display: block; font-size: 0.9rem; color: #5d4037; margin-bottom: 5px; font-weight: bold; }
        input, textarea { width: 100%; padding: 10px; border: 1px solid #d2b48c; border-radius: 8px; box-sizing: border-box; }
        
        .status-msg { font-size: 0.8rem; margin-top: 10px; display: none; }
    </style>
</head>
<body onclick="shootFlower()">

    <div id="game-container">
        <div id="basket">üß∫</div>
        <div id="ui-layer">
            <p id="score-board">Score: <span id="score">0</span> / 10</p>
            <p style="color: #ff758f;">Catch 10 roses for a surprise!</p>
        </div>
    </div>

    <div id="valentine-screen">
        <div class="flower-container" id="final-flower">
            <div class="stem" id="stem"></div>
        </div>
        <h1 id="valentine-text">You caught my heart!<br>Will you be my Valentine?</h1>
        <div id="hint-text">Nice try! üòâ</div>
        
        <div class="btn-group" id="btnGroup">
            <div class="row" id="mainBtns">
                <button id="yesBtn" onclick="celebrate()">YES</button>
                <button id="noBtn" onmouseover="moveNo()" ontouchstart="moveNo()">NO</button>
            </div>
            <button id="readLetterBtn" class="secondary-btn" onclick="openModal('letter-modal')">Read my letter üíå</button>
            <button id="planDateBtn" class="secondary-btn" onclick="openModal('plan-modal')">Plan our date üóìÔ∏è</button>
        </div>
    </div>

    <div id="letter-modal" class="modal">
        <h2 style="color: var(--deep-red)">To My Valentine,</h2>
        <p style="font-family: Georgia; font-style: italic;">
            My Love at first sight, my inspiration, my light in the darkness, my hope and my purpose, my princess, my ezer. This is our 4th Valentine and my love for your keeps on growing. You're still the love of my life, now and forever.<br>
            Your Charming Knight :P
        </p>
        <button onclick="closeModal('letter-modal')" style="background: #8b4513; color: white; padding: 10px 20px; border-radius: 20px;">Close</button>
    </div>

    <div id="plan-modal" class="modal">
        <h2 style="color: #2d6a4f">Valentine's Planner</h2>
        <form id="dateForm" action="https://formspree.io/f/xbdkvkrj" method="POST">
            <div class="form-group">
                <label>What do you want to do love?</label>
                <input type="text" name="activity" required placeholder="Food Date, Movie Date, F...">
            </div>
            <div class="form-group">
                <label>Where do you wanna go?</label>
                <input type="text" name="location" required placeholder="Restaurant name, Motel name etc...">
            </div>
            <div class="form-group">
                <label>Special requests/Gift Request hahaha?</label>
                <textarea name="requests" rows="2" placeholder="Gift, Bag, F..."></textarea>
            </div>
            <button type="submit" id="submitBtn" style="background: #2d6a4f; color: white; width: 100%; border-radius: 10px;">Send it to MEE</button>
            <div id="status" class="status-msg"></div>
        </form>
    </div>

    <script>
        let score = 0;
        let noAttempts = 0;
        const basket = document.getElementById('basket');
        let basketPos = 50;
        let basketDir = 1;

        setInterval(() => {
            basketPos += (2.5 * basketDir);
            if (basketPos > 80 || basketPos < 10) basketDir *= -1;
            basket.style.left = basketPos + '%';
        }, 20);

        function shootFlower() {
            if (score >= 10 || document.getElementById('valentine-screen').style.display === 'flex') return;
            const f = document.createElement('div');
            f.className = 'flower-projectile';
            f.innerHTML = 'üåπ';
            f.style.left = '50%';
            document.getElementById('game-container').appendChild(f);

            let currentBottom = 0;
            const shootInterval = setInterval(() => {
                currentBottom += 12;
                f.style.bottom = currentBottom + 'px';
                const fRect = f.getBoundingClientRect();
                const bRect = basket.getBoundingClientRect();

                if (fRect.top <= bRect.bottom && fRect.left < bRect.right && fRect.right > bRect.left) {
                    score++;
                    document.getElementById('score').innerText = score;
                    f.remove();
                    clearInterval(shootInterval);
                    if (score >= 10) startValentine();
                }
                if (currentBottom > window.innerHeight) { f.remove(); clearInterval(shootInterval); }
            }, 16);
        }

        function startValentine() {
            document.getElementById('game-container').style.display = 'none';
            document.getElementById('valentine-screen').style.display = 'flex';
            const container = document.getElementById('final-flower');
            document.getElementById('stem').className = 'stem stem-anim';
            for(let i=0; i<8; i++) {
                const p = document.createElement('div');
                p.className = 'petal bloom-anim';
                p.style.transform = `rotate(${i * 45}deg)`;
                p.style.animationDelay = (i * 0.1) + 's';
                container.appendChild(p);
            }
        }

        function moveNo() {
            noAttempts++;
            const btn = document.getElementById('noBtn');
            if (noAttempts >= 3) document.getElementById('hint-text').style.opacity = '1';
            const maxX = window.innerWidth - btn.offsetWidth - 20;
            const maxY = window.innerHeight - btn.offsetHeight - 20;
            btn.style.left = Math.max(10, Math.floor(Math.random() * maxX)) + 'px';
            btn.style.top = Math.max(10, Math.floor(Math.random() * maxY)) + 'px';
        }

        function celebrate() {
            document.getElementById('valentine-text').innerHTML = "I knew you'd say yes! ‚ù§Ô∏è";
            document.getElementById('mainBtns').style.display = 'none';
            document.getElementById('hint-text').style.display = 'none';
            document.getElementById('readLetterBtn').style.display = 'block';
            document.getElementById('planDateBtn').style.display = 'block';
            for(let i=0; i<30; i++) { setTimeout(createHeart, i * 100); }
        }

        function openModal(id) { document.getElementById(id).style.display = 'block'; }
        function closeModal(id) { document.getElementById(id).style.display = 'none'; }

        // Formspree Handling
        const form = document.getElementById("dateForm");
        async function handleSubmit(event) {
            event.preventDefault();
            const status = document.getElementById("status");
            const data = new FormData(event.target);
            fetch(event.target.action, {
                method: form.method,
                body: data,
                headers: { 'Accept': 'application/json' }
            }).then(response => {
                if (response.ok) {
                    status.innerHTML = "Sent! I can't wait! ü•∞";
                    status.style.display = "block";
                    status.style.color = "#2d6a4f";
                    form.reset();
                    setTimeout(() => closeModal('plan-modal'), 2000);
                } else {
                    status.innerHTML = "Oops! Try again.";
                    status.style.display = "block";
                }
            });
        }
        form.addEventListener("submit", handleSubmit);

        function createHeart() {
            const h = document.createElement('div');
            h.innerHTML = '‚ù§Ô∏è';
            h.style.position = 'fixed';
            h.style.left = Math.random() * 100 + 'vw';
            h.style.top = '100vh';
            h.style.fontSize = (Math.random() * 20 + 15) + 'px';
            document.body.appendChild(h);
            const anim = h.animate([
                { transform: 'translateY(0)', opacity: 1 },
                { transform: `translateY(-110vh) rotate(${Math.random() * 360}deg)`, opacity: 0 }
            ], { duration: 3000 });
            anim.onfinish = () => h.remove();
        }
    </script>
</body>
</html>
